# AI選股系統檔案問題分析與修正建議

## 🚨 發現的問題

### 1. Docker Compose 配置問題

#### 問題 A：前端端口映射錯誤
```yaml
# 目前配置（錯誤）
frontend:
  ports:
    - "3000:80"  # ❌ 錯誤：前端容器內使用3000端口，不是80
```

#### 問題 B：資料收集器Dockerfile路徑錯誤
```yaml
# 目前配置（錯誤）
data_collector:
  build:
    context: ./backend  # ❌ 錯誤：應該使用data_collector目錄
    dockerfile: Dockerfile
```

#### 問題 C：Nginx配置檔案路徑錯誤
```yaml
# 目前配置（錯誤）
nginx:
  volumes:
    - ./deployment/nginx.conf:/etc/nginx/nginx.conf  # ❌ 路徑不對
```

#### 問題 D：缺少環境變數一致性
- Docker Compose中的環境變數名稱與config.py不完全匹配

### 2. Main.py 配置問題

#### 問題 A：Celery Beat調度器配置錯誤
```python
# 目前配置（錯誤）
command: celery -A celery_app beat --scheduler django_celery_beat.schedulers:DatabaseScheduler
```
❌ 使用了Django調度器，但這是FastAPI專案

#### 問題 B：缺少模組路徑
- 某些import路徑可能無法正確解析

### 3. 缺失的配置檔案

1. **Celery配置檔案** - `backend/celery_app.py`
2. **日誌配置** - `backend/app/utils/logging.py`
3. **資料庫管理** - `backend/app/database.py` 的完整版本
4. **API路由檔案** - `backend/app/api/` 目錄下的路由檔案

## 🔧 修正方案

### 修正 1：更新 Docker Compose 配置

```yaml
# 修正後的 docker-compose.yml 關鍵部分
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"  # ✅ 修正端口映射
    environment:
      - VITE_API_BASE_URL=http://localhost:8000

  data_collector:
    build:
      context: ./data_collector  # ✅ 使用正確路徑
      dockerfile: Dockerfile
    volumes:
      - ./data_collector:/app
      - ./backend/app:/app/backend_app  # 共享後端代碼

  nginx:
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf  # ✅ 正確路徑

  celery_beat:
    command: celery -A celery_app beat --loglevel=info  # ✅ 移除Django調度器
```

### 修正 2：需要新增的檔案

以下檔案是系統正常運作必須的：

1. **`backend/celery_app.py`** - Celery應用配置
2. **`backend/app/database.py`** - 資料庫連接管理
3. **`backend/app/utils/logging.py`** - 日誌系統
4. **`backend/app/api/stocks.py`** - 股票API路由
5. **`backend/app/api/analysis.py`** - 分析API路由
6. **`backend/app/api/recommendations.py`** - 推薦API路由

### 修正 3：環境變數統一

```bash
# .env 檔案需要添加的變數
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/1
INFLUXDB_USER=admin
INFLUXDB_PASSWORD=influx_password
INFLUXDB_ORG=stock_org
INFLUXDB_BUCKET=stock_timeseries
INFLUXDB_TOKEN=your_influxdb_token
```

## 🎯 優先級修正順序

### 🔥 高優先級（必須立即修正）
1. 修正Docker Compose端口映射
2. 建立Celery配置檔案
3. 建立資料庫連接檔案
4. 建立API路由檔案

### 🔥 中優先級（影響功能）
1. 修正Nginx配置路徑
2. 統一環境變數命名
3. 建立日誌系統

### 🔥 低優先級（優化項目）
1. 加強錯誤處理
2. 添加更多監控指標
3. 優化效能設定

## 💡 建議的下一步

1. **我將為您提供所有缺失的檔案**
2. **修正現有檔案的配置問題**
3. **提供更新後的docker-compose.yml**
4. **建立完整的測試腳本**

這樣您就能擁有一個完全可運作的AI選股系統！