# 🎯 AI選股系統完整檔案檢查清單與部署指南

## 📋 檔案完整性檢查清單

### ✅ 必須檔案（系統無法運作）

#### 🔧 配置檔案
- [ ] `docker-compose.yml` (修正版)
- [ ] `.env` (修正版)
- [ ] `nginx/nginx.conf`
- [ ] `monitoring/prometheus.yml`

#### 🐍 後端核心檔案
- [ ] `backend/requirements.txt` (您已提供)
- [ ] `backend/Dockerfile`
- [ ] `backend/main.py` (您已提供)
- [ ] `backend/config.py` (您已提供)
- [ ] `backend/celery_app.py` ✅ 新增
- [ ] `backend/app/database.py` ✅ 新增
- [ ] `backend/app/utils/logging.py` ✅ 新增

#### 📡 API 路由檔案
- [ ] `backend/app/api/__init__.py`
- [ ] `backend/app/api/stocks.py` ✅ 新增
- [ ] `backend/app/api/analysis.py` ✅ 新增
- [ ] `backend/app/api/recommendations.py` ✅ 新增

#### 📅 任務檔案
- [ ] `backend/app/tasks/__init__.py`
- [ ] `backend/app/tasks/scheduled_tasks.py` ✅ 新增

#### 🎨 前端檔案
- [ ] `frontend/Dockerfile` (修正版)
- [ ] `frontend/package.json` ✅ 新增
- [ ] `frontend/tsconfig.json` ✅ 新增
- [ ] `frontend/tsconfig.node.json` ✅ 新增
- [ ] `frontend/vite.config.ts` ✅ 新增

#### 📊 資料收集器檔案
- [ ] `data_collector/Dockerfile` ✅ 新增
- [ ] `data_collector/requirements.txt` ✅ 新增

#### 🚀 部署腳本
- [ ] `scripts/start.sh` ✅ 新增

### ⚠️ 重要檔案（建議新增）

#### 📝 API 初始化檔案
```python
# backend/app/api/__init__.py
# 空檔案即可，用於模組識別
```

#### 📋 任務初始化檔案
```python
# backend/app/tasks/__init__.py
# 空檔案即可，用於模組識別
```

#### 🗄️ 資料庫模型檔案
- [ ] `backend/app/models/__init__.py` (您已有)
- [ ] `backend/app/models/stock.py` (您已有)

## 🔧 關鍵修正內容

### 1. Docker Compose 修正項目
- ✅ 修正前端端口映射 `3000:3000`
- ✅ 修正資料收集器建構路徑
- ✅ 修正 Nginx 配置檔案路徑
- ✅ 移除 Django Celery Beat 調度器
- ✅ 統一環境變數命名

### 2. 環境變數統一
- ✅ PostgreSQL 變數與 Docker Compose 一致
- ✅ InfluxDB 變數與 Docker Compose 一致
- ✅ Redis 密碼設定一致
- ✅ Celery 配置正確

### 3. 前端建構修正
- ✅ 使用正確的端口 3000
- ✅ 修正 Dockerfile 建構流程
- ✅ 添加健康檢查

## 🚀 部署步驟

### 步驟 1：檔案準備
```bash
# 確保所有檔案都在正確位置
ai-stock-selector/
├── .env                                    # ✅ 修正版
├── docker-compose.yml                     # ✅ 修正版
├── backend/
│   ├── Dockerfile
│   ├── requirements.txt                   # ✅ 您已有
│   ├── main.py                           # ✅ 您已有
│   ├── config.py                         # ✅ 您已有
│   ├── celery_app.py                     # ✅ 新增
│   └── app/
│       ├── database.py                   # ✅ 新增
│       ├── utils/
│       │   └── logging.py                # ✅ 新增
│       ├── api/
│       │   ├── __init__.py               # 空檔案
│       │   ├── stocks.py                 # ✅ 新增
│       │   ├── analysis.py               # ✅ 新增
│       │   └── recommendations.py       # ✅ 新增
│       └── tasks/
│           ├── __init__.py               # 空檔案
│           └── scheduled_tasks.py        # ✅ 新增
├── frontend/
│   ├── Dockerfile                        # ✅ 修正版
│   ├── package.json                      # ✅ 新增
│   ├── tsconfig.json                     # ✅ 新增
│   ├── tsconfig.node.json               # ✅ 新增
│   └── vite.config.ts                   # ✅ 新增
├── data_collector/
│   ├── Dockerfile                        # ✅ 新增
│   └── requirements.txt                  # ✅ 新增
├── nginx/
│   └── nginx.conf                        # ✅ 新增
├── monitoring/
│   └── prometheus.yml                    # ✅ 新增
└── scripts/
    └── start.sh                          # ✅ 新增
```

### 步驟 2：設定執行權限
```bash
chmod +x scripts/start.sh
```

### 步驟 3：環境變數設定
```bash
# 複製並編輯環境變數
cp .env .env.local

# 必須修改的密碼：
# - POSTGRES_PASSWORD
# - REDIS_PASSWORD  
# - INFLUXDB_PASSWORD
# - SECRET_KEY
# - JWT_SECRET_KEY
```

### 步驟 4：建立必要目錄
```bash
mkdir -p logs/backend logs/data_collector logs/celery logs/nginx
mkdir -p monitoring/grafana/dashboards monitoring/grafana/datasources
mkdir -p backups
```

### 步驟 5：啟動系統
```bash
# 方法一：使用啟動腳本
./scripts/start.sh start

# 方法二：手動啟動
docker-compose build
docker-compose up -d
```

## 🔍 驗證部署

### 檢查服務狀態
```bash
# 檢查所有容器狀態
docker-compose ps

# 檢查日誌
docker-compose logs -f backend
docker-compose logs -f data_collector
```

### 測試 API 端點
```bash
# 健康檢查
curl http://localhost:8000/health

# 股票 API
curl http://localhost:8000/api/stocks/

# 前端
curl http://localhost:3000/
```

### 訪問系統
- **前端界面**: http://localhost:3000
- **API 文檔**: http://localhost:8000/docs  
- **Celery 監控**: http://localhost:5555
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3001

## 🐛 常見問題排解

### 1. 容器無法啟動
```bash
# 檢查特定服務日誌
docker-compose logs [service_name]

# 重新建構
docker-compose build --no-cache [service_name]
```

### 2. 端口衝突
```bash
# 檢查端口使用
netstat -tlnp | grep :5432
netstat -tlnp | grep :8000

# 修改 docker-compose.yml 端口映射
```

### 3. 環境變數問題
```bash
# 檢查環境變數載入
docker-compose config
```

### 4. 資料庫連接失敗
```bash
# 檢查 PostgreSQL 狀態
docker-compose exec postgres pg_isready -U stock_user

# 手動連接測試
docker-compose exec postgres psql -U stock_user -d ai_stock_db
```

## 📊 系統監控

### 檢查系統狀態
```bash
# 查看資源使用
docker stats

# 查看服務健康狀態
curl http://localhost:8000/health
```

### 日誌監控
```bash
# 實時查看所有日誌
docker-compose logs -f

# 查看特定服務日誌
docker-compose logs -f backend data_collector
```

## 🎉 部署成功確認

✅ 所有容器正常運行  
✅ API 健康檢查通過  
✅ 前端可正常訪問  
✅ 資料庫連接正常  
✅ Celery 任務正常執行  
✅ 監控系統運作正常  

## 🔄 下一步工作

1. **測試所有 API 端點**
2. **設定真實的資料收集邏輯**
3. **實作完整的 AI 模型**
4. **設定監控警報**
5. **建立備份策略**
6. **效能調優**

---

**🚀 恭喜！您的 AI選股系統現在已經可以完整運作了！**

所有檔案都已經準備就緒，只需要按照上述步驟部署即可。如果遇到任何問題，請檢查日誌檔案並參考常見問題排解指南。